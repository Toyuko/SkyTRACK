import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import { settingsStorage, type LanguageCode } from './services/settingsStorage';

const STORAGE_KEY = 'skynet_settings';

const resources = {
  en: {
    translation: {
      common: {
        close: 'Close',
        cancel: 'Cancel',
        system: 'System',
        light: 'Light',
        dark: 'Dark',
        enabled: 'Enabled',
        disabled: 'Disabled',
        yes: 'Yes',
        no: 'No',
      },
      app: {
        title: 'SkyNet',
        subtitle: 'ACARS',
        booked: 'Booked',
        freeFlight: 'Free Flight',
        clearFlightAria: 'Clear flight',
        openSettingsAria: 'Open settings',
        searchAndBook: 'Search & Book',
        searchAndBookFlight: 'Search & Book Flight',
        startFreeFlight: 'Start Free Flight',
        viewMap: 'View Live Map',
        backToDashboard: 'Back to Dashboard',
      },
      status: {
        connected: 'CONNECTED',
        connecting: 'CONNECTING...',
        error: 'ERROR',
        disconnected: 'DISCONNECTED',
        mockData: 'MOCK DATA',
        waitingForFlightData: 'Waiting for flight data...',
        connectingToBackend: 'Connecting to SkyNet backend...',
        startFlightToSeeData: 'Start a flight to see data',
      },
      labels: {
        callsign: 'Callsign',
        aircraft: 'Aircraft',
        route: 'Route',
        flightPhase: 'Flight Phase',
        altitude: 'Altitude',
        groundSpeed: 'Ground Speed',
        fuelRemaining: 'Fuel Remaining',
        heading: 'Heading',
        position: 'Position',
        flightStatistics: 'Flight Statistics',
        flightTime: 'Flight Time',
        distanceTraveled: 'Distance Traveled',
        distanceRemaining: 'Distance Remaining',
        eta: 'ETA',
        fuelFlow: 'Fuel Flow',
        fuelEndurance: 'Fuel Endurance',
        averageSpeed: 'Average Speed',
        lastUpdate: 'Last update: {{time}}',
        noDataReceived: 'No data received',
        mockDataMode: 'Mock Data Mode',
        advancedMetrics: 'Advanced Metrics',
      },
      flightSearch: {
        depAirportIcao: 'Departure Airport (ICAO)',
        arrAirportIcao: 'Arrival Airport (ICAO)',
        flightNumber: 'Flight Number',
        searching: 'Searching...',
        searchFlights: 'Search Flights',
        phpvmsNotConfiguredShort: 'phpVMS is not configured',
        phpvmsNotConfiguredLong: 'phpVMS is not configured. Please configure it in settings.',
        noFlightsFound: 'No flights found. Try different search criteria.',
        enterCriteria: 'Enter search criteria and click "Search Flights"',
        aircraftLabel: 'Aircraft: {{icao}}',
        distanceLabel: 'Distance: {{distance}} nm',
        estTimeLabel: 'Est. Time: {{minutes}} min',
        bookFlight: 'Book Flight',
        failedToSearch: 'Failed to search flights',
        failedToBook: 'Failed to book flight',
      },
      freeFlight: {
        aircraftIcao: 'Aircraft ICAO',
        startFlight: 'Start Flight',
        simbriefUsername: 'SimBrief username',
        fetchFromSimbrief: 'Fetch from SimBrief',
        simbriefFetching: 'Fetching…',
        simbriefFetchFailed: 'Failed to fetch SimBrief plan',
        simbriefUsernameRequired: 'Enter your SimBrief username',
      },
      flightLog: {
        title: 'Flight Log',
        settings: 'Settings',
        flightSearch: 'Flight Search',
        activeFlight: 'Active Flight',
        compass: 'Compass',
        logbook: 'Logbook',
        files: 'Files',
        links: 'Links',
        addComment: 'Add a comment to the flight log...',
        comment: 'Comment',
        flyingOffline: 'Flying Offline',
        flyingOnline: 'Flying Online',
        pauseAtTod: 'Pause at Top of Descent',
        pause: 'Pause',
      },
      flightInProgress: {
        connectedTo: 'Connected to: {{simulator}}',
        onTime: 'On time',
        fuelOnTarget: 'Fuel burn on target',
        flightTime: '{{current}} / {{total}}',
        boarding: 'Boarding',
        recoveryAvailable: 'Recovery Available',
        recoverFlight: 'Recover Flight',
        flightInProgress: 'Flight In Progress',
        cancelFlight: 'Cancel Flight',
        mobile: 'Mobile',
        mapboxTokenRequired: 'Mapbox token required',
        mapboxTokenHint: 'Please set VITE_MAPBOX_TOKEN environment variable',
        waitingForData: 'Waiting for flight data...',
      },
      settings: {
        title: 'Settings',
        closeAria: 'Close settings',
        appearance: 'Appearance',
        theme: 'Theme',
        language: 'Language',
        connection: 'Connection',
        websocketUrl: 'WebSocket URL',
        websocketPlaceholder: 'ws://localhost:3000/ws/skynet:flights',
        websocketRestartHint: 'Restart the app to apply WebSocket URL changes',
        simulator: 'Simulator',
        simulatorHint: 'Select your flight simulator',
        autoReconnect: 'Auto-reconnect',
        autoReconnectHint: 'Automatically reconnect when connection is lost',
        reconnectInterval: 'Reconnect Interval (ms)',
        display: 'Display',
        enableMockData: 'Enable Mock Data',
        enableMockDataHint: 'Show simulated data when disconnected',
        advancedMetrics: 'Advanced Metrics',
        advancedMetricsHint: 'Show additional flight metrics and statistics',
        phpvmsIntegration: 'phpVMS Integration',
        enablePhpvms: 'Enable phpVMS',
        enablePhpvmsHint: 'Connect to phpVMS virtual airline system',
        phpvmsBaseUrl: 'phpVMS Base URL',
        phpvmsBaseUrlPlaceholder: 'https://your-va.com',
        apiToken: 'API Token',
        apiTokenPlaceholder: 'Your phpVMS API token',
        apiTokenHint: 'Get your API token from phpVMS admin panel',
        resetToDefaults: 'Reset to Defaults',
        resetConfirm: 'Are you sure you want to reset all settings to defaults?',
      },
      languages: {
        en: 'English',
        es: 'Spanish',
        fr: 'French',
        ja: 'Japanese',
      },
      map: {
        flights: 'flights',
        atcStations: 'ATC stations',
      },
      atc: {
        source: 'Source',
        frequency: 'Frequency',
        facility: 'Facility',
        controller: 'Controller',
        rating: 'Rating',
        visualRange: 'Visual Range',
        position: 'Position',
        atis: 'ATIS',
        logonTime: 'Logon Time',
        lastUpdated: 'Last Updated',
        firZone: 'FIR Zone',
      },
    },
  },
  es: {
    translation: {
      common: {
        close: 'Cerrar',
        cancel: 'Cancelar',
        system: 'Sistema',
        light: 'Claro',
        dark: 'Oscuro',
        enabled: 'Activado',
        disabled: 'Desactivado',
        yes: 'Sí',
        no: 'No',
      },
      app: {
        title: 'SkyNet',
        subtitle: 'ACARS',
        booked: 'Reservado',
        freeFlight: 'Vuelo libre',
        clearFlightAria: 'Borrar vuelo',
        openSettingsAria: 'Abrir configuración',
        searchAndBook: 'Buscar y reservar',
        searchAndBookFlight: 'Buscar y reservar vuelo',
        startFreeFlight: 'Iniciar vuelo libre',
        viewMap: 'Ver mapa en vivo',
        backToDashboard: 'Volver al Panel',
      },
      status: {
        connected: 'CONECTADO',
        connecting: 'CONECTANDO...',
        error: 'ERROR',
        disconnected: 'DESCONECTADO',
        mockData: 'DATOS SIMULADOS',
        waitingForFlightData: 'Esperando datos de vuelo...',
        connectingToBackend: 'Conectando al backend de SkyNet...',
        startFlightToSeeData: 'Inicia un vuelo para ver los datos',
      },
      labels: {
        callsign: 'Indicativo',
        aircraft: 'Aeronave',
        route: 'Ruta',
        flightPhase: 'Fase de vuelo',
        altitude: 'Altitud',
        groundSpeed: 'Velocidad terrestre',
        fuelRemaining: 'Combustible restante',
        heading: 'Rumbo',
        position: 'Posición',
        flightStatistics: 'Estadísticas de vuelo',
        flightTime: 'Tiempo de vuelo',
        distanceTraveled: 'Distancia recorrida',
        distanceRemaining: 'Distancia restante',
        eta: 'ETA',
        fuelFlow: 'Consumo de combustible',
        fuelEndurance: 'Autonomía',
        averageSpeed: 'Velocidad media',
        lastUpdate: 'Última actualización: {{time}}',
        noDataReceived: 'No se recibieron datos',
        mockDataMode: 'Modo de datos simulados',
        advancedMetrics: 'Métricas avanzadas',
      },
      flightSearch: {
        depAirportIcao: 'Aeropuerto de salida (ICAO)',
        arrAirportIcao: 'Aeropuerto de llegada (ICAO)',
        flightNumber: 'Número de vuelo',
        searching: 'Buscando...',
        searchFlights: 'Buscar vuelos',
        phpvmsNotConfiguredShort: 'phpVMS no está configurado',
        phpvmsNotConfiguredLong: 'phpVMS no está configurado. Configúralo en Ajustes.',
        noFlightsFound: 'No se encontraron vuelos. Prueba otros criterios.',
        enterCriteria: 'Introduce criterios de búsqueda y haz clic en "Buscar vuelos"',
        aircraftLabel: 'Aeronave: {{icao}}',
        distanceLabel: 'Distancia: {{distance}} nm',
        estTimeLabel: 'Tiempo est.: {{minutes}} min',
        bookFlight: 'Reservar vuelo',
        failedToSearch: 'No se pudieron buscar vuelos',
        failedToBook: 'No se pudo reservar el vuelo',
      },
      freeFlight: {
        aircraftIcao: 'ICAO de aeronave',
        startFlight: 'Iniciar vuelo',
        simbriefUsername: 'Usuario SimBrief',
        fetchFromSimbrief: 'Obtener de SimBrief',
        simbriefFetching: 'Obteniendo…',
        simbriefFetchFailed: 'Error al obtener el plan SimBrief',
        simbriefUsernameRequired: 'Introduce tu usuario SimBrief',
      },
      flightLog: {
        title: 'Registro de Vuelo',
        settings: 'Configuración',
        flightSearch: 'Búsqueda de Vuelos',
        activeFlight: 'Vuelo Activo',
        compass: 'Brújula',
        logbook: 'Libro de Vuelo',
        files: 'Archivos',
        links: 'Enlaces',
        addComment: 'Añadir un comentario al registro de vuelo...',
        comment: 'Comentario',
        flyingOffline: 'Volando Sin Conexión',
        flyingOnline: 'Volando En Línea',
        pauseAtTod: 'Pausar en Inicio de Descenso',
        pause: 'Pausar',
      },
      flightInProgress: {
        connectedTo: 'Conectado a: {{simulator}}',
        onTime: 'A tiempo',
        fuelOnTarget: 'Consumo de combustible según lo previsto',
        flightTime: '{{current}} / {{total}}',
        boarding: 'Embarque',
        recoveryAvailable: 'Recuperación Disponible',
        recoverFlight: 'Recuperar Vuelo',
        flightInProgress: 'Vuelo en Curso',
        cancelFlight: 'Cancelar Vuelo',
        mobile: 'Móvil',
        mapboxTokenRequired: 'Token de Mapbox requerido',
        mapboxTokenHint: 'Por favor configure la variable de entorno VITE_MAPBOX_TOKEN',
        waitingForData: 'Esperando datos de vuelo...',
      },
      settings: {
        title: 'Ajustes',
        closeAria: 'Cerrar ajustes',
        appearance: 'Apariencia',
        theme: 'Tema',
        language: 'Idioma',
        connection: 'Conexión',
        websocketUrl: 'URL de WebSocket',
        websocketPlaceholder: 'ws://localhost:3000/ws/skynet:flights',
        websocketRestartHint: 'Reinicia la app para aplicar los cambios de WebSocket',
        simulator: 'Simulador',
        simulatorHint: 'Selecciona tu simulador de vuelo',
        autoReconnect: 'Reconexión automática',
        autoReconnectHint: 'Reconectar automáticamente si se pierde la conexión',
        reconnectInterval: 'Intervalo de reconexión (ms)',
        display: 'Pantalla',
        enableMockData: 'Habilitar datos simulados',
        enableMockDataHint: 'Mostrar datos simulados cuando esté desconectado',
        advancedMetrics: 'Métricas avanzadas',
        advancedMetricsHint: 'Mostrar métricas y estadísticas adicionales',
        phpvmsIntegration: 'Integración con phpVMS',
        enablePhpvms: 'Habilitar phpVMS',
        enablePhpvmsHint: 'Conectar con el sistema de aerolínea virtual phpVMS',
        phpvmsBaseUrl: 'URL base de phpVMS',
        phpvmsBaseUrlPlaceholder: 'https://tu-va.com',
        apiToken: 'Token API',
        apiTokenPlaceholder: 'Tu token API de phpVMS',
        apiTokenHint: 'Obtén tu token API desde el panel de administración de phpVMS',
        resetToDefaults: 'Restablecer valores',
        resetConfirm: '¿Seguro que quieres restablecer todos los ajustes?',
      },
      languages: {
        en: 'Inglés',
        es: 'Español',
        fr: 'Francés',
        ja: 'Japonés',
      },
      map: {
        flights: 'vuelos',
        atcStations: 'estaciones ATC',
      },
      atc: {
        source: 'Fuente',
        frequency: 'Frecuencia',
        facility: 'Instalación',
        controller: 'Controlador',
        rating: 'Calificación',
        visualRange: 'Alcance Visual',
        position: 'Posición',
        atis: 'ATIS',
        logonTime: 'Hora de Conexión',
        lastUpdated: 'Última Actualización',
        firZone: 'Zona FIR',
      },
    },
  },
  fr: {
    translation: {
      common: {
        close: 'Fermer',
        cancel: 'Annuler',
        system: 'Système',
        light: 'Clair',
        dark: 'Sombre',
        enabled: 'Activé',
        disabled: 'Désactivé',
        yes: 'Oui',
        no: 'Non',
      },
      app: {
        title: 'SkyNet',
        subtitle: 'ACARS',
        booked: 'Réservé',
        freeFlight: 'Vol libre',
        clearFlightAria: 'Effacer le vol',
        openSettingsAria: 'Ouvrir les paramètres',
        searchAndBook: 'Rechercher & réserver',
        searchAndBookFlight: 'Rechercher & réserver un vol',
        startFreeFlight: 'Démarrer un vol libre',
        viewMap: 'Voir la carte en direct',
        backToDashboard: 'Retour au Tableau de Bord',
      },
      status: {
        connected: 'CONNECTÉ',
        connecting: 'CONNEXION...',
        error: 'ERREUR',
        disconnected: 'DÉCONNECTÉ',
        mockData: 'DONNÉES SIMULÉES',
        waitingForFlightData: 'En attente des données de vol...',
        connectingToBackend: 'Connexion au backend SkyNet...',
        startFlightToSeeData: 'Démarrez un vol pour voir les données',
      },
      labels: {
        callsign: 'Indicatif',
        aircraft: 'Avion',
        route: 'Route',
        flightPhase: 'Phase de vol',
        altitude: 'Altitude',
        groundSpeed: 'Vitesse sol',
        fuelRemaining: 'Carburant restant',
        heading: 'Cap',
        position: 'Position',
        flightStatistics: 'Statistiques de vol',
        flightTime: 'Temps de vol',
        distanceTraveled: 'Distance parcourue',
        distanceRemaining: 'Distance restante',
        eta: 'ETA',
        fuelFlow: 'Débit carburant',
        fuelEndurance: 'Autonomie',
        averageSpeed: 'Vitesse moyenne',
        lastUpdate: 'Dernière mise à jour : {{time}}',
        noDataReceived: 'Aucune donnée reçue',
        mockDataMode: 'Mode données simulées',
        advancedMetrics: 'Mesures avancées',
      },
      flightSearch: {
        depAirportIcao: 'Aéroport de départ (ICAO)',
        arrAirportIcao: 'Aéroport d’arrivée (ICAO)',
        flightNumber: 'Numéro de vol',
        searching: 'Recherche...',
        searchFlights: 'Rechercher des vols',
        phpvmsNotConfiguredShort: 'phpVMS n’est pas configuré',
        phpvmsNotConfiguredLong: 'phpVMS n’est pas configuré. Configurez-le dans les paramètres.',
        noFlightsFound: 'Aucun vol trouvé. Essayez d’autres critères.',
        enterCriteria: 'Saisissez des critères puis cliquez sur « Rechercher des vols »',
        aircraftLabel: 'Avion : {{icao}}',
        distanceLabel: 'Distance : {{distance}} nm',
        estTimeLabel: 'Temps estimé : {{minutes}} min',
        bookFlight: 'Réserver',
        failedToSearch: 'Échec de la recherche de vols',
        failedToBook: 'Échec de la réservation du vol',
      },
      freeFlight: {
        aircraftIcao: 'ICAO avion',
        startFlight: 'Démarrer le vol',
        simbriefUsername: 'Nom d\'utilisateur SimBrief',
        fetchFromSimbrief: 'Récupérer depuis SimBrief',
        simbriefFetching: 'Récupération…',
        simbriefFetchFailed: 'Échec de la récupération du plan SimBrief',
        simbriefUsernameRequired: 'Saisissez votre nom d\'utilisateur SimBrief',
      },
      flightLog: {
        title: 'Journal de Vol',
        settings: 'Paramètres',
        flightSearch: 'Recherche de Vol',
        activeFlight: 'Vol Actif',
        compass: 'Boussole',
        logbook: 'Carnet de Vol',
        files: 'Fichiers',
        links: 'Liens',
        addComment: 'Ajouter un commentaire au journal de vol...',
        comment: 'Commentaire',
        flyingOffline: 'Vol Hors Ligne',
        flyingOnline: 'Vol En Ligne',
        pauseAtTod: 'Pause au Début de la Descente',
        pause: 'Pause',
      },
      flightInProgress: {
        connectedTo: 'Connecté à : {{simulator}}',
        onTime: 'À l\'heure',
        fuelOnTarget: 'Consommation de carburant conforme',
        flightTime: '{{current}} / {{total}}',
        boarding: 'Embarquement',
        recoveryAvailable: 'Récupération Disponible',
        recoverFlight: 'Récupérer le Vol',
        flightInProgress: 'Vol en Cours',
        cancelFlight: 'Annuler le Vol',
        mobile: 'Mobile',
        mapboxTokenRequired: 'Token Mapbox requis',
        mapboxTokenHint: 'Veuillez définir la variable d\'environnement VITE_MAPBOX_TOKEN',
        waitingForData: 'En attente des données de vol...',
      },
      settings: {
        title: 'Paramètres',
        closeAria: 'Fermer les paramètres',
        appearance: 'Apparence',
        theme: 'Thème',
        language: 'Langue',
        connection: 'Connexion',
        websocketUrl: 'URL WebSocket',
        websocketPlaceholder: 'ws://localhost:3000/ws/skynet:flights',
        websocketRestartHint: 'Redémarrez l’app pour appliquer les changements d’URL WebSocket',
        simulator: 'Simulateur',
        simulatorHint: 'Sélectionnez votre simulateur de vol',
        autoReconnect: 'Reconnexion auto',
        autoReconnectHint: 'Se reconnecter automatiquement en cas de coupure',
        reconnectInterval: 'Intervalle de reconnexion (ms)',
        display: 'Affichage',
        enableMockData: 'Activer les données simulées',
        enableMockDataHint: 'Afficher des données simulées en cas de déconnexion',
        advancedMetrics: 'Mesures avancées',
        advancedMetricsHint: 'Afficher des mesures et statistiques supplémentaires',
        phpvmsIntegration: 'Intégration phpVMS',
        enablePhpvms: 'Activer phpVMS',
        enablePhpvmsHint: 'Se connecter au système de compagnie virtuelle phpVMS',
        phpvmsBaseUrl: 'URL de base phpVMS',
        phpvmsBaseUrlPlaceholder: 'https://votre-va.com',
        apiToken: 'Jeton API',
        apiTokenPlaceholder: 'Votre jeton API phpVMS',
        apiTokenHint: 'Récupérez votre jeton API dans le panneau d’admin phpVMS',
        resetToDefaults: 'Réinitialiser',
        resetConfirm: 'Voulez-vous vraiment réinitialiser tous les paramètres ?',
      },
      languages: {
        en: 'Anglais',
        es: 'Espagnol',
        fr: 'Français',
        ja: 'Japonais',
      },
      map: {
        flights: 'vols',
        atcStations: 'stations ATC',
      },
      atc: {
        source: 'Source',
        frequency: 'Fréquence',
        facility: 'Installation',
        controller: 'Contrôleur',
        rating: 'Note',
        visualRange: 'Portée Visuelle',
        position: 'Position',
        atis: 'ATIS',
        logonTime: 'Heure de Connexion',
        lastUpdated: 'Dernière Mise à Jour',
        firZone: 'Zone FIR',
      },
    },
  },
  ja: {
    translation: {
      common: {
        close: '閉じる',
        cancel: 'キャンセル',
        system: 'システム',
        light: 'ライト',
        dark: 'ダーク',
        enabled: '有効',
        disabled: '無効',
        yes: 'はい',
        no: 'いいえ',
      },
      app: {
        title: 'SkyNet',
        subtitle: 'ACARS',
        booked: '予約済み',
        freeFlight: 'フリーフライト',
        clearFlightAria: 'フライトをクリア',
        openSettingsAria: '設定を開く',
        searchAndBook: '検索＆予約',
        searchAndBookFlight: 'フライト検索＆予約',
        startFreeFlight: 'フリーフライト開始',
        viewMap: 'ライブマップを表示',
        backToDashboard: 'ダッシュボードに戻る',
      },
      status: {
        connected: '接続済み',
        connecting: '接続中...',
        error: 'エラー',
        disconnected: '未接続',
        mockData: 'モックデータ',
        waitingForFlightData: 'フライトデータを待機中...',
        connectingToBackend: 'SkyNet バックエンドに接続中...',
        startFlightToSeeData: 'フライトを開始するとデータが表示されます',
      },
      labels: {
        callsign: 'コールサイン',
        aircraft: '機材',
        route: 'ルート',
        flightPhase: 'フライトフェーズ',
        altitude: '高度',
        groundSpeed: '対地速度',
        fuelRemaining: '残燃料',
        heading: '方位',
        position: '位置',
        flightStatistics: 'フライト統計',
        flightTime: '飛行時間',
        distanceTraveled: '飛行距離',
        distanceRemaining: '残距離',
        eta: '到着予定',
        fuelFlow: '燃料消費',
        fuelEndurance: '燃料持続',
        averageSpeed: '平均速度',
        lastUpdate: '最終更新: {{time}}',
        noDataReceived: 'データ未受信',
        mockDataMode: 'モックデータモード',
        advancedMetrics: '詳細メトリクス',
      },
      flightSearch: {
        depAirportIcao: '出発空港（ICAO）',
        arrAirportIcao: '到着空港（ICAO）',
        flightNumber: '便名',
        searching: '検索中...',
        searchFlights: 'フライト検索',
        phpvmsNotConfiguredShort: 'phpVMS が未設定です',
        phpvmsNotConfiguredLong: 'phpVMS が未設定です。設定で構成してください。',
        noFlightsFound: 'フライトが見つかりません。条件を変えてください。',
        enterCriteria: '条件を入力して「フライト検索」をクリックしてください',
        aircraftLabel: '機材: {{icao}}',
        distanceLabel: '距離: {{distance}} nm',
        estTimeLabel: '予定時間: {{minutes}} 分',
        bookFlight: '予約',
        failedToSearch: 'フライト検索に失敗しました',
        failedToBook: '予約に失敗しました',
      },
      freeFlight: {
        aircraftIcao: '機材 ICAO',
        startFlight: '開始',
        simbriefUsername: 'SimBrief ユーザー名',
        fetchFromSimbrief: 'SimBriefから取得',
        simbriefFetching: '取得中…',
        simbriefFetchFailed: 'SimBrief計画の取得に失敗しました',
        simbriefUsernameRequired: 'SimBriefユーザー名を入力してください',
      },
      flightLog: {
        title: 'フライトログ',
        settings: '設定',
        flightSearch: 'フライト検索',
        activeFlight: 'アクティブフライト',
        compass: 'コンパス',
        logbook: 'ログブック',
        files: 'ファイル',
        links: 'リンク',
        addComment: 'フライトログにコメントを追加...',
        comment: 'コメント',
        flyingOffline: 'オフラインフライト',
        flyingOnline: 'オンラインフライト',
        pauseAtTod: '降下開始時に一時停止',
        pause: '一時停止',
      },
      flightInProgress: {
        connectedTo: '接続先: {{simulator}}',
        onTime: '時間通り',
        fuelOnTarget: '燃料消費は目標通り',
        flightTime: '{{current}} / {{total}}',
        boarding: '搭乗中',
        recoveryAvailable: '回復可能',
        recoverFlight: 'フライトを回復',
        flightInProgress: 'フライト進行中',
        cancelFlight: 'フライトをキャンセル',
        mobile: 'モバイル',
        mapboxTokenRequired: 'Mapboxトークンが必要です',
        mapboxTokenHint: '環境変数 VITE_MAPBOX_TOKEN を設定してください',
        waitingForData: 'フライトデータを待機中...',
      },
      settings: {
        title: '設定',
        closeAria: '設定を閉じる',
        appearance: '外観',
        theme: 'テーマ',
        language: '言語',
        connection: '接続',
        websocketUrl: 'WebSocket URL',
        websocketPlaceholder: 'ws://localhost:3000/ws/skynet:flights',
        websocketRestartHint: 'WebSocket URL の変更を反映するにはアプリを再起動してください',
        simulator: 'シミュレーター',
        simulatorHint: '使用するフライトシミュレーターを選択してください',
        autoReconnect: '自動再接続',
        autoReconnectHint: '切断時に自動で再接続します',
        reconnectInterval: '再接続間隔（ms）',
        display: '表示',
        enableMockData: 'モックデータを有効化',
        enableMockDataHint: '未接続時にシミュレートデータを表示します',
        advancedMetrics: '詳細メトリクス',
        advancedMetricsHint: '追加のフライト統計を表示します',
        phpvmsIntegration: 'phpVMS 連携',
        enablePhpvms: 'phpVMS を有効化',
        enablePhpvmsHint: 'phpVMS バーチャルエアラインに接続します',
        phpvmsBaseUrl: 'phpVMS ベースURL',
        phpvmsBaseUrlPlaceholder: 'https://your-va.com',
        apiToken: 'API トークン',
        apiTokenPlaceholder: 'phpVMS の API トークン',
        apiTokenHint: 'phpVMS 管理画面から API トークンを取得してください',
        resetToDefaults: '初期化',
        resetConfirm: 'すべての設定を初期値に戻しますか？',
      },
      languages: {
        en: '英語',
        es: 'スペイン語',
        fr: 'フランス語',
        ja: '日本語',
      },
      map: {
        flights: 'フライト',
        atcStations: 'ATC局',
      },
      atc: {
        source: 'ソース',
        frequency: '周波数',
        facility: '施設',
        controller: '管制官',
        rating: '評価',
        visualRange: '視認範囲',
        position: '位置',
        atis: 'ATIS',
        logonTime: 'ログオン時間',
        lastUpdated: '最終更新',
        firZone: 'FIRゾーン',
      },
    },
  },
} as const;

function normalizeLanguage(input: string): LanguageCode {
  const code = input.toLowerCase();
  if (code.startsWith('es')) return 'es';
  if (code.startsWith('fr')) return 'fr';
  if (code.startsWith('ja')) return 'ja';
  return 'en';
}

const stored = (() => {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return null;
    const parsed = JSON.parse(raw) as { language?: string };
    return parsed.language ? normalizeLanguage(parsed.language) : null;
  } catch {
    return null;
  }
})();
const detected = typeof navigator !== 'undefined' ? normalizeLanguage(navigator.language || 'en') : 'en';
const initialLanguage = stored || detected;

void i18n
  .use(initReactI18next)
  .init({
    resources,
    lng: initialLanguage,
    fallbackLng: 'en',
    interpolation: { escapeValue: false },
  });

export function setAppLanguage(lang: LanguageCode) {
  settingsStorage.setLanguage(lang);
  void i18n.changeLanguage(lang);
}

export default i18n;

